<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ARISE SYSTEM</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">

<style>
body{
margin:0;
background:#0b0f1a;
color:#00eaff;
font-family:system-ui;
text-align:center;
}

h1{margin:12px;font-size:22px}

.panel{
border:1px solid #00eaff55;
margin:10px;
padding:12px;
border-radius:12px;
}

.quest{
border:1px solid #00eaff44;
margin:12px 0;
padding:12px;
border-radius:10px;
}

.penalty{
border-color:red;
color:#ff6b6b;
}

button{
background:black;
color:#00eaff;
border:1px solid #00eaff;
padding:8px 14px;
margin:4px;
border-radius:6px;
}

button:disabled{opacity:.4}

#levelup{
position:fixed;
top:40%;
width:100%;
font-size:34px;
display:none;
}

@media(max-width:600px){
.panel{margin:8px}
button{width:80px}
}
</style>
</head>
<body>

<h1>âš” ARISE SYSTEM</h1>

<div class="panel">
Level <span id=lvl></span> |
XP <span id=xp></span> |
Rank <span id=rank></span> |
Streak <span id=streak></span>
</div>

<div class="panel">
STR <span id=str></span> |
INT <span id=int></span> |
FOC <span id=foc></span>
</div>

<div class="panel">
<button onclick="enableNotif()">Enable Notifications</button>
</div>

<div class="panel">
<h3>Daily Quests</h3>
<div id=daily></div>
</div>

<div class="panel">
<h3>Penalty Quests</h3>
<div id=penalty></div>
</div>

<div id=levelup>LEVEL UP</div>

<audio id=beep src="beep.mp3"></audio>

<script>
/* ---------- PWA ---------- */
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}

/* ---------- DATA ---------- */

const QUESTS={
Exercise:{time:1200,xp:20,stat:"str"},
Thinking:{time:1800,xp:25,stat:"foc"},
Skill:{time:3600,xp:40,stat:"int"},
Strategy:{time:2400,xp:30,stat:"int"},
Problem:{time:1800,xp:25,stat:"foc"}
};

/* ---------- STORAGE ---------- */

const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load=(k,d)=>JSON.parse(localStorage.getItem(k))??d;

/* ---------- PLAYER ---------- */

let xp=load("xp",0);
let lvl=load("lvl",1);
let str=load("str",0);
let int=load("int",0);
let foc=load("foc",0);
let streak=load("streak",0);

const today=new Date().toDateString();
let last=load("last","");

/* ---------- DAY RESET ---------- */

if(last!==today){

let done=load("done",{});
let missed={};

for(let q in QUESTS)
if(!done[q]) missed[q]=true;

save("penalty",missed);
save("done",{});
save("last",today);

streak = Object.keys(missed).length?0:streak+1;
save("streak",streak);
}

/* ---------- RANK ---------- */

function rank(){
if(lvl>=100)return"S";
if(lvl>=75)return"A";
if(lvl>=50)return"B";
if(lvl>=30)return"C";
if(lvl>=10)return"D";
return"E";
}

/* ---------- UI ---------- */

const el=id=>document.getElementById(id);

function ui(){
el("lvl").textContent=lvl;
el("xp").textContent=xp;
el("rank").textContent=rank();
el("str").textContent=str;
el("int").textContent=int;
el("foc").textContent=foc;
el("streak").textContent=streak;
}

/* ---------- XP ---------- */

function addXP(n){
xp+=n;
if(xp>=100){
xp-=100;
lvl++;
anim();
}
save("xp",xp);
save("lvl",lvl);
ui();
}

function stat(s){
if(s=="str"){str+=5;save("str",str);}
if(s=="int"){int+=5;save("int",int);}
if(s=="foc"){foc+=5;save("foc",foc);}
ui();
}

function anim(){
let e=el("levelup");
e.style.display="block";
setTimeout(()=>e.style.display="none",1200);
}

/* ---------- TIMER ---------- */

function startTimer(name,time,xpGain,statType,isPenalty){

let left=time;

const t=el("t"+name);
const s=el("s"+name);
const p=el("p"+name);
const d=el("d"+name);

s.disabled=true;
p.disabled=false;

let intv=setInterval(()=>{
left--;
let m=Math.floor(left/60);
let s2=left%60;
t.textContent=m+":"+(s2<10?"0":"")+s2;

if(left<=0){
clearInterval(intv);
p.disabled=true;
d.disabled=false;
notify(name+" finished");
beep.play().catch(()=>{});
}
},1000);

p.onclick=()=>{
clearInterval(intv);
s.disabled=false;
p.disabled=true;
};

s.onclick=()=>startTimer(name,left,xpGain,statType,isPenalty);

d.onclick=()=>{
if(left>0)return;

addXP(xpGain);
stat(statType);

let done=load("done",{});
done[name]=true;
save("done",done);

if(isPenalty){
let pen=load("penalty",{});
delete pen[name];
save("penalty",pen);
renderPenalty();
}

d.disabled=true;
};
}

/* ---------- RENDER DAILY ---------- */

function renderDaily(){
daily.innerHTML="";
let done=load("done",{});
let pen=load("penalty",{});

for(let q in QUESTS){

if(pen[q]) continue; // hide penalty ones

const d=QUESTS[q];

let div=document.createElement("div");
div.className="quest";
div.innerHTML=`
<b>${q}</b><br>
<span id=t${q}>${Math.floor(d.time/60)}:00</span><br>
<button id=s${q}>Start</button>
<button id=p${q} disabled>Pause</button>
<button id=d${q} disabled>Done</button>
`;

daily.appendChild(div);

el("s"+q).onclick=()=>startTimer(q,d.time,d.xp,d.stat,false);

if(done[q]) div.style.opacity=.3;
}
}

/* ---------- PENALTY ---------- */

function renderPenalty(){
penalty.innerHTML="";
let pen=load("penalty",{});

for(let q in pen){

const d=QUESTS[q];

let div=document.createElement("div");
div.className="quest penalty";
div.innerHTML=`
<b>Penalty: ${q}</b><br>
<span id=t${q}>${Math.floor(d.time/60)}:00</span><br>
<button id=s${q}>Start</button>
<button id=p${q} disabled>Pause</button>
<button id=d${q} disabled>Done</button>
`;

penalty.appendChild(div);

el("s"+q).onclick=
()=>startTimer(q,d.time,Math.floor(d.xp/2),d.stat,true);
}
}

/* ---------- NOTIFICATION ---------- */

function enableNotif(){
Notification.requestPermission();
}

function notify(txt){
if(Notification.permission==="granted")
new Notification("ARISE",{body:txt});
}

/* ---------- INIT ---------- */

renderDaily();
renderPenalty();
ui();
</script>
</body>
</html>
